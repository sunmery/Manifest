apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: connect-example-backend
  namespace: argocd
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  # æ¥æºï¼šæŒ‡å‘æ‚¨çš„ Helm Chart ä»“åº“ï¼ˆå³åº”ç”¨ä»£ç ä»“åº“ï¼‰
  source:
    # ğŸš¨ å¿…é¡»æŒ‡å‘åŒ…å« Helm Chart çš„ Git ä»“åº“ URL
    repoURL: https://github.com/sunmery/connect-example.git
    # Helm Chart æ‰€åœ¨è·¯å¾„
    path: helm
    targetRevision: main        # ç›‘æ§çš„åˆ†æ”¯
    helm:
      # ğŸ’¡ å­¦ä¹ èµ„æ–™å¼ºè°ƒï¼šreleaseName é»˜è®¤ç­‰äº Application name
      releaseName: connect-example-backend
      # **ä½¿ç”¨ valueFiles è¦†ç›–ï¼š**
      # å¦‚æœæ‚¨çš„ GitHub Actions æ›´æ”¹äº† values.yamlï¼ŒArgo CD å°†è‡ªåŠ¨è¯»å–æ–°å€¼
      valueFiles:
        - values.yaml
      # **ä½¿ç”¨ parameters è¦†ç›–ï¼š**
      # æ‚¨ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œç¡¬ç¼–ç å‚æ•°ï¼Œä½†ä¼šè¦†ç›– values.yaml ä¸­çš„å€¼ (æœ€é«˜ä¼˜å…ˆçº§)
      # parameters:
      #   - name: "service.type"
      #     value: LoadBalancer

  # ç›®æ ‡ï¼šæŒ‡å®šéƒ¨ç½²åˆ°å“ªä¸ªé›†ç¾¤å’Œå‘½åç©ºé—´
  destination:
    server: "https://kubernetes.default.svc" # é›†ç¾¤ API Server åœ°å€
    namespace: connect-example

  # åŒæ­¥ç­–ç•¥
  syncPolicy:
    automated: # å¯ç”¨è‡ªåŠ¨åŒ–åŒæ­¥
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true # è‡ªåŠ¨åˆ›å»ºå‘½åç©ºé—´
